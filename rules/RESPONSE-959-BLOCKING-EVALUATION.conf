# ------------------------------------------------------------------------
# OWASP ModSecurity Core Rule Set ver.3.1.0
# Copyright (c) 2006-2017 Trustwave and contributors. All rights reserved.
#
# The OWASP ModSecurity Core Rule Set is distributed under
# Apache Software License (ASL) version 2
# Please see the enclosed LICENSE file for full details.
# ------------------------------------------------------------------------

# You should set the score to the proper threshold you would prefer. If kept at "@gt 0"
# it will work similarly to previous Mod CRS rules and will create an event in the error_log
# file if there are any rules that match.  If you would like to lessen the number of events
# generated in the error_log file, you should increase the anomaly score threshold to
# something like "@gt 20".  This would only generate an event in the error_log file if
# there are multiple lower severity rule matches or if any 1 higher severity item matches.
#
# You should also set the desired disruptive action (deny, redirect, etc...).
#

#
# -= Paranoia Level 0 (empty) =- (apply unconditionally)
#

# Alert and Block on High Anomaly Scores - this would block outbound data leakages
#
SecRule TX:OUTBOUND_ANOMALY_SCORE "@ge %{tx.outbound_anomaly_score_threshold}" \
    "id:959100,\
    phase:4,\
    deny,\
    t:none,\
    msg:'Outbound Anomaly Score Exceeded (Total Score: %{TX.OUTBOUND_ANOMALY_SCORE})',\
    tag:'anomaly-evaluation'"

SecRule TX:OUTBOUND_ANOMALY_SCORE_PL1 "@ge %{tx.outbound_anomaly_score_threshold_pl1}" \
    "id:959101,\
    phase:4,\
    deny,\
    t:none,\
    msg:'PL1 Outbound Anomaly Score Exceeded (Total Score: %{TX.OUTBOUND_ANOMALY_SCORE_PL1})',\
    tag:'anomaly-evaluation'"

SecRule TX:OUTBOUND_ANOMALY_SCORE_PL21 "@ge %{tx.outbound_anomaly_score_threshold_pl2}" \
    "id:959102,\
    phase:4,\
    deny,\
    t:none,\
    msg:'PL2 Outbound Anomaly Score Exceeded (Total Score: %{TX.OUTBOUND_ANOMALY_SCORE_PL2})',\
    tag:'anomaly-evaluation'"

SecRule TX:OUTBOUND_ANOMALY_SCORE_PL3 "@ge %{tx.outbound_anomaly_score_threshold_pl3}" \
    "id:959103,\
    phase:4,\
    deny,\
    t:none,\
    msg:'PL3 Outbound Anomaly Score Exceeded (Total Score: %{TX.OUTBOUND_ANOMALY_SCORE_PL3})',\
    tag:'anomaly-evaluation'"

SecRule TX:OUTBOUND_ANOMALY_SCORE_PL4 "@ge %{tx.outbound_anomaly_score_threshold_pl4}" \
    "id:959104,\
    phase:4,\
    deny,\
    t:none,\
    msg:'PL4 Outbound Anomaly Score Exceeded (Total Score: %{TX.OUTBOUND_ANOMALY_SCORE_PL4})',\
    tag:'anomaly-evaluation'"



SecRule TX:PARANOIA_LEVEL "@lt 1" "id:959011,phase:3,pass,nolog,tag:'paranoia-level/1',skipAfter:END-RESPONSE-959-BLOCKING-EVALUATION"
SecRule TX:PARANOIA_LEVEL "@lt 1" "id:959012,phase:4,pass,nolog,tag:'paranoia-level/1',skipAfter:END-RESPONSE-959-BLOCKING-EVALUATION"
#
# -= Paranoia Level 1 (default) =- (apply only when tx.paranoia_level is sufficiently high: 1 or higher)
#



SecRule TX:PARANOIA_LEVEL "@lt 2" "id:959013,phase:3,pass,nolog,tag:'paranoia-level/2',skipAfter:END-RESPONSE-959-BLOCKING-EVALUATION"
SecRule TX:PARANOIA_LEVEL "@lt 2" "id:959014,phase:4,pass,nolog,tag:'paranoia-level/2',skipAfter:END-RESPONSE-959-BLOCKING-EVALUATION"
#
# -= Paranoia Level 2 =- (apply only when tx.paranoia_level is sufficiently high: 2 or higher)
#



SecRule TX:PARANOIA_LEVEL "@lt 3" "id:959015,phase:3,pass,nolog,tag:'paranoia-level/3',skipAfter:END-RESPONSE-959-BLOCKING-EVALUATION"
SecRule TX:PARANOIA_LEVEL "@lt 3" "id:959016,phase:4,pass,nolog,tag:'paranoia-level/3',skipAfter:END-RESPONSE-959-BLOCKING-EVALUATION"
#
# -= Paranoia Level 3 =- (apply only when tx.paranoia_level is sufficiently high: 3 or higher)
#



SecRule TX:PARANOIA_LEVEL "@lt 4" "id:959017,phase:3,pass,nolog,tag:'paranoia-level/4',skipAfter:END-RESPONSE-959-BLOCKING-EVALUATION"
SecRule TX:PARANOIA_LEVEL "@lt 4" "id:959018,phase:4,pass,nolog,tag:'paranoia-level/4',skipAfter:END-RESPONSE-959-BLOCKING-EVALUATION"
#
# -= Paranoia Level 4 =- (apply only when tx.paranoia_level is sufficiently high: 4 or higher)
#



#
# -= Paranoia Levels Finished =-
#
SecMarker "END-RESPONSE-959-BLOCKING-EVALUATION"
